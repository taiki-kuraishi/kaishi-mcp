# @kaishi-mcp/syllabus-api-trpc-client

Type-safe tRPC client package for consuming the syllabus-api service. This package provides client-side bindings with automatic type inference and serialization support for interacting with syllabus data.

## Overview

The `@kaishi-mcp/syllabus-api-trpc-client` package provides:

- **Type-Safe API Client**: Full TypeScript support with automatic type inference
- **tRPC Integration**: Built on tRPC for end-to-end type safety
- **Serialization Support**: Uses SuperJSON for handling complex data types
- **Workspace Integration**: Seamless integration with other packages in the monorepo

## Directory Structure

```
packages/syllabus-api-trpc-client/
├── src/
│   └── index.ts                    # Main client export and configuration
├── dist/                           # Compiled TypeScript output
├── package.json                    # Package configuration
└── tsconfig.json                   # TypeScript configuration
```

### Key Files

- **`src/index.ts`**: Main entry point that exports the configured tRPC client
- **`dist/index.js`**: Compiled JavaScript output (generated by TypeScript)
- **`dist/index.d.ts`**: TypeScript type definitions (generated by TypeScript)

## Usage

### Basic Usage

```typescript
import { syllabusApiClient } from '@kaishi-mcp/syllabus-api-trpc-client';

// Use the client to interact with the syllabus API
const syllabi = await syllabusApiClient.getAllSyllabi.query();
const syllabus = await syllabusApiClient.getSyllabusById.query({ id: 'syllabus-id' });
```

### Client Configuration

The client is pre-configured with:

- **SuperJSON transformer**: For handling complex data types like dates
- **HTTP transport**: For communication with the syllabus API service
- **Type inference**: Automatic TypeScript types from the API schema

### Error Handling

```typescript
import { TRPCError } from '@trpc/client';

try {
  const result = await syllabusApiClient.someOperation.query(params);
} catch (error) {
  if (error instanceof TRPCError) {
    console.error('API Error:', error.message);
  }
}
```

### Mutations

```typescript
// Example of creating or updating data
const newSyllabus = await syllabusApiClient.createSyllabus.mutate({
  title: 'New Course',
  description: 'Course description'
});

const updatedSyllabus = await syllabusApiClient.updateSyllabus.mutate({
  id: 'syllabus-id',
  title: 'Updated Title'
});
```

## Development and Testing

### Development Commands

- **Type checking**: `bun run check:type`
- **Build package**: `bun run build`
- **Check for unused code**: `bun run check:knip`

### Building

```bash
# Build the package
bun run build

# This will compile TypeScript files to the dist/ directory
```

### Dependencies

- **@trpc/client**: Core tRPC client library
- **superjson**: Serialization library for complex data types
- **@kaishi-mcp/syllabus-api**: Workspace dependency for type definitions

## Package Exports

The package exports the following:

```typescript
// Main tRPC client instance
export { syllabusApiClient } from './src/index.js';

// Re-export useful types from tRPC
export type { TRPCError } from '@trpc/client';
```

## Integration

This package is used by:

- **packages/mcp-server**: For MCP tool implementations that need syllabus data
- **apps/remote-mcp**: For direct API access in the Cloudflare Worker
- Other applications that need to interact with syllabus data

### Installation in Other Packages

```json
{
  "dependencies": {
    "@kaishi-mcp/syllabus-api-trpc-client": "workspace:*"
  }
}
```

### Environment Configuration

The client requires the `SYLLABUS_API_URL` environment variable to be set:

```bash
# Example environment configuration
SYLLABUS_API_URL=https://your-syllabus-api.example.com
```

## Type Safety

This package provides full end-to-end type safety:

- **Input validation**: Parameters are validated at compile time
- **Output types**: Return types are automatically inferred
- **Error types**: Structured error handling with proper TypeScript types
- **Serialization**: Complex types like dates are handled automatically

The type safety is maintained through the workspace dependency on `@kaishi-mcp/syllabus-api`, ensuring that client and server types stay in sync.
